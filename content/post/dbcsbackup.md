+++
author = "jisun.kang"
categories = ["Data Management"]
date = "2017-05-10T16:20:58+09:00"
description = "데이타베이스 클라우드 서비스 환경에서 기본으로 구성되는 백업 방법에 대해서 먼저 소개한 후 기본 구성을 변경하는 방법에 대해서 소개합니다"
language = "bsh"
tags = ["database", "data management", "DBCS", "backup" ]
thumbnailInList = "https://oracloud-kr-teamrepo.github.io/2017/05/dbcs_backup/Logo.png"
thumbnailInPost = ""
title = "데이타베이스 클라우드 서비스 인스턴스에서 백업 구성"
+++

본 문서에서는 데이타베이스 클라우드 서비스 환경에서 기본으로 구성되는 백업 구성에 대해서 소개하고 해당 구성을 변경하는 방법에 대해서 소개합니다.
데이타베이스 클라우드 서비스는 기본으로 데이타베이스, 데이타베이스 및 그리드 인프라스트럭처(RAC 구성시) 관련 구성 파일, 시스템 및 클라우드 Tooling 관련 파일에 대한 백업을 수행할 수 있는 기능을 지원합니다. 이러한 백업 기능을 지원하기 위해서 시스템 유틸리티, 오라클 데이타베이스 유틸리티, 오라클 데이타베이스 백업 서비스를 활용하며 이 모든 서비스는 인스턴스 생성시 자동으로 설치됩니다.

오라클 데이타베이스 백업 서비스에 대한 상세 정보는 <a href="/post/obcs/">이곳</a>를 참고하십시오.

## 기본 백업 구성

### 인스턴스 생성시의 백업 구성 선택

인스턴스 생성시 백업 대상으로 "__클라우드 저장 영역과 로컬 저장__", "__클라우드 저장 영역만__", "__없음__"  중 한 가지를 선택할 수 있습니다. __클라우드 저장 영역__ 은 데이타베이스 백업 서비스에 저장하고 __로컬 저장__ 시에는 데이타베이스 인스턴스가 사용하는 블록 스토리지에 내부적으로 저장됩니다. 백업이 저장되는 스토리지 볼륨의 이름은 "__fra__" 입니다. __fra__ 영역은 "__클라우드 저장 영역과 로컬 저장__" 선택시에는 "__사용가능한 데이타베이스 저장 영역__" 의 1.7 배의 사이즈로, 그 이외의 경우에는 0.1 배 (최소 7GB)의 사이즈로 생성됩니다.

> 데이타베이스 자체가 저장되는 스토리지 볼륨은 "__data__" 로 "__사용가능한 데이타베이스 저장 영역__" 에 입력한 값과 같은 사이즈로  생성됩니다.

그림 1은 인스턴스 생성시 백업 구성을 선택하는 화면으로 아래 표를 참고하여 맞는 값을 입력하여 주시면 됩니다.

- 그림 1. 인스턴스 생성시 백업 구성을 입력하는 화면
![](https://oracloud-kr-teamrepo.github.io/2017/05/dbcs_backup/dbcs-creation1.PNG)

| 항목 | 입력값 |
| ------ | ------ |
| 클라우드 저장 영역 컨테이너 | Storage-"Identity Domain"/"컨테이너 이름" |
| 클라우드 저장 영역 사용자 이름	| 데이타베이스 백업 클라우드 로그인 계정 |
| 클라우드 저장 영역 비밀번호 | 데이타베이스 백업 클라우드 로그인계정 패스워드 |
| 클라우드 저장 영역 컨테이너 생성 | 백업시 새로운 컨테이너 사용을 원하는 경우 선택 |

### 백업 구성 및 이력 확인

데이타베이스 콘솔에서 인스턴스를 선택하여 상세 정보 확인시 백업 구성에 대한 정보를 확인할 수 있습니다.

- 그림 2. 인스턴스에 대한 상세 정보 확인 화면
![](https://oracloud-kr-teamrepo.github.io/2017/05/dbcs_backup/DBCS-status.PNG)

"__관리__" 를 클릭하면 현재시점까지 백업된 정보에 대한 이력 확인이 가능하고 원하는 백업으로 바로 복구할 수 있습니다. 복구시에는 원하는 백업 옆의 리스트 아이콘을 클릭하고 ```Recover``` 를 선택하시면 됩니다.

- 그림 3. 백업에 대한 이력 확인 등 백업 관련 화면
![](https://oracloud-kr-teamrepo.github.io/2017/05/dbcs_backup/backup-history.PNG)

언제든지 그림 3의 ```Backup Now```를 클릭하여 원하는 시점에 매뉴얼 백업을 수행하실 수 있습니다.

### 기본 백업 구성에 대한 상세 설명

기본 백업 구성은 오라클 베스트 프랙티스 가이드라인을 따라서 설정되어 있습니다.

- 데이타베이스의 경우 RMAN 유틸리티를 사용하여 백업합니다. 기본 백업 정책은 주단위 전체 백업(Full Backup, 레벨 0 백업), 일단위 증분 백업(Incremental backup, 레벨 1 백업)으로 클라우드 스토리지는 30일 데이타가 보관되고 로컬 스토리지에는 7일 데이타가 보관됩니다.
- 데이타베이스 및 시스템 구성 파일은 백업 수행시 같이 백업됩니다.
- 매일 11시 (23:00)에서 3시 (03:00) 사이의 시간에 자동 백업이 수행되며 데이터베이스 생성시 설정됩니다. 백업 시간은 변경 가능하며 변경 방법에 대해서는 뒤에서 설명드리겠습니다.
- 백업 보관주기는 "__클라우드 저장 영역과 로컬 저장__"시에는 30일로 로컬 스토리지에 최근 7 일간의 백업이 저장됩니다. __클라우드 저장 영역__ 시도 30일로 같습니다.
- 클라우드 저장 영역에 대한 저장되는 모든 백업은 암호화됩니다. 로컬 스토리지의 경우 Enterprise Edition 선택시에만 암호화되고 Standard Edition 의 경우 암호화되지 않습니다.
- 아카이브는 기본으로 구성되어 아카이브 파일은 한 시간에 두 번씩 백업됩니다.

## 백업 구성 변경

### 백업 시간 및 아카이브 백업 주기 변경

데이타베이스 클라우드 서비스의 백업 기능은 정기적인 수행을 위해서 __cron__ 스케줄링을 사용합니다. 다음은 /etc/crontab의 내용으로 데이타베이스 파일 백업은 매일 2:55에 수행되고, 아카이브 로그 백업은 매시 0분, 30분에 수행됩니다.

<pre class="prettyprint">
55 2 * * * root /var/opt/oracle/bkup_api/bkup_api bkup_start --dbname=ORCL
0,30 * * * * root /var/opt/oracle/bkup_api/bkup_api bkup_archlogs --dbname=ORCL
15 03 * * 6 oracle /var/opt/oracle/cleandb/cleandblogs.pl
</pre>

해당 구성을 변경함으로써 기본 백업 시간 및 아카이브 백업 주기를 변경할 수 있습니다.

### 백업 보관 주기 변경

__opc__ 사용자로 로그인 한 후 root 권한으로 아래 명령어를 수행합니다. 백업에 대한 보관주기 변경시에는 rman 유틸리티를 사용하지 않아야 합니다.

<pre class="prettyprint">
$ sudo -s
# /var/opt/oracle/bkup_api/bkup_api bkup_chgcfg --retention=days
</pre>

### 백업 대상 파일 확인 및 추가/변경

백업 대상 시스템 파일은 __/home/oracle/bkup/oscfg.spec__ 에서, 데이타베이스 설정 파일은 __/home/oracle/bkup/dbcfg.spec__ 에서 확인가능합니다. 백업 대상 파일을 추가하고자 하는 경우에는 위에서 나열된 파일 이름을 변경하면 됩니다.

### 데이타베이스 백업 관련 구성 확인/변경

데이타베이스 백업 관련 구성은 __oracle__ 사용자로 로그인한 후 RMAN 명령어를 통해서 관련 설정을 확인하실 수 있습니다. 설정을 변경하고자 하는 경우에는 RMAN 명령얼르 사용합니다. __show all__  명령어 수행시 현재 구성이 표시됩니다.

<pre class="prettyprint">
$ rman target =/
   ...
   RMAN > show all
</pre>

## 마치며

이제까지 데이타베이스 클라우드 서비스의 기본 백업 구성 방법을 살펴보고 기본 구성을 변경하는 방법에 대해서 살펴보았습니다. 사용자가 직접 백업 환경을 구성하고 관리해야 했던 On-Premise 환경 대비, 데이타베이스 클라우드 서비스 환경에서는 필요한 구성이 기본으로 설정되고 관리되기 때문에 훨신 더 편하게 백업을 구성하시고 관리하실 수 있으실 것입니다.

더 자세한 정보는 아래의 사이트를 확인바랍니다.

https://cloud.oracle.com/en_US/database <br />
https://cloud.oracle.com/en_US/database-backup <br />
http://docs.oracle.com/en/cloud/paas/database-dbaas-cloud/books.html
